<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Controle de Almoxarifado{% endblock %}</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    
<style>
    body { font-family: 'Inter', sans-serif; background-color: #f1f5f9; }
    .nav-link.active { background-color: #059669; color: white; }
    .content-section { display: none; }
    .content-section.active { display: block; }

    /* Estilo para o submenu dropdown no header */
    .dropdown-menu {
        display: none; /* Começa escondido */
    }
    .dropdown-menu.show {
        display: block; /* Mostra quando a classe 'show' é adicionada via JS */
    }
</style>

</head>
<body class="bg-gray-100">

    <div class="flex flex-col h-screen">
        
        <header class="bg-white shadow-md sticky top-0 z-40">
            <div class="container mx-auto px-4">
                <div class="flex justify-between items-center h-16">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-green-600 rounded-lg flex items-center justify-center mr-3">
                            <i class="fas fa-warehouse text-white"></i>
                        </div>
                        <h1 class="text-lg font-bold text-gray-900 hidden sm:block">Almoxarifado F6P</h1>
                    </div>

                    <nav class="hidden md:flex items-center space-x-2">
                        <a href="#" class="nav-link flex items-center px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100" data-section="dashboard">
                            <i class="fas fa-tachometer-alt fa-fw mr-2"></i>Dashboard
                        </a>
                        
                        <div class="relative">
                            <button class="nav-dropdown-toggle flex items-center px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100">
                                <i class="fas fa-cogs fa-fw mr-2"></i>
                                <span>Gerenciamento</span>
                                <i class="fas fa-chevron-down ml-2 text-xs"></i>
                            </button>
                            <div class="dropdown-menu absolute right-0 mt-2 w-56 bg-white rounded-md shadow-lg py-1">
                                
                                <a href="#" class="nav-link flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" data-section="movimentacoes"><i class="fas fa-exchange-alt fa-fw mr-3 text-gray-400"></i>Movimentações</a>
                                <a href="#" class="nav-link flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" data-section="controle_combustivel"><i class="fas fa-gas-pump fa-fw mr-3 text-gray-400"></i>Combustível</a>
                                <a href="#" class="nav-link flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" data-section="manutencoes"><i class="fas fa-tools fa-fw mr-3 text-gray-400"></i>Manutenções</a>
                                
                            </div>
                        </div>

                        <div class="relative">
                            <button class="nav-dropdown-toggle flex items-center px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100">
                                <i class="fas fa-chart-bar fa-fw mr-2"></i>
                                <span>Relatórios</span>
                                <i class="fas fa-chevron-down ml-2 text-xs"></i>
                            </button>
                            <div class="dropdown-menu absolute right-0 mt-2 w-64 bg-white rounded-md shadow-lg py-1">
                                <a href="#" id="relatorio-mov-trigger" class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                    <i class="fas fa-exchange-alt fa-fw mr-3 text-gray-400"></i>Relatório de Movimentações
                                </a>
                               
                                <a href="#" id="relatorio-man-trigger" class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                    <i class="fas fa-tools fa-fw mr-3 text-gray-400"></i>Relatório de Custos de Manutenção
                                </a>
                                <a href="#" id="relatorio-est-trigger" class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                    <i class="fas fa-boxes-stacked fa-fw mr-3 text-gray-400"></i>Relatório de Posição de Estoque
                                </a>


                                <a href="#" id="relatorio-saida-combustivel-trigger" class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                    <i class="fas fa-gas-pump fa-fw mr-3 text-gray-400"></i>Relatório de Saída de Combustível
                                </a>

                            </div>
                        </div>
                        
                        <div class="relative">
                            <button class="nav-dropdown-toggle flex items-center px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100">
                                <i class="fas fa-archive fa-fw mr-2"></i>
                                <span>Cadastros</span>
                                <i class="fas fa-chevron-down ml-2 text-xs"></i>
                            </button>
                            <div class="dropdown-menu absolute right-0 mt-2 w-56 bg-white rounded-md shadow-lg py-1">
                                <a href="#" class="nav-link flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" data-section="almoxarifados"><i class="fas fa-warehouse fa-fw mr-3 text-gray-400"></i>Almoxarifados</a>
                                <a href="#" class="nav-link flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" data-section="setores"><i class="fas fa-building fa-fw mr-3 text-gray-400"></i>Setores</a>
                                <a href="#" class="nav-link flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" data-section="categorias"><i class="fas fa-tags fa-fw mr-3 text-gray-400"></i>Categorias</a>
                                <a href="#" class="nav-link flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" data-section="produtos"><i class="fas fa-boxes-stacked fa-fw mr-3 text-gray-400"></i>Produtos</a>
                                <a href="#" class="nav-link flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" data-section="funcionarios"><i class="fas fa-user-tie fa-fw mr-3 text-gray-400"></i>Funcionários</a>
                                <a href="#" class="nav-link flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" data-section="fornecedores"><i class="fas fa-truck-field fa-fw mr-3 text-gray-400"></i>Fornecedores</a>
                                {% if current_user.role == 'gerente' or current_user.role == 'supervisor' %}
                                    <a href="#" class="nav-link flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" data-section="funcoes"><i class="fas fa-id-card fa-fw mr-3 text-gray-400"></i>Funções</a>
                                    <a href="#" class="nav-link flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" data-section="tipos_combustivel"><i class="fas fa-gas-pump fa-fw mr-3 text-gray-400"></i>Tipos de Combustível</a>
                                    <a href="#" class="nav-link flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" data-section="tipos_veiculo"><i class="fas fa-car-side fa-fw mr-3 text-gray-400"></i>Tipos de Veículo</a>
                                    <a href="#" class="nav-link flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" data-section="veiculos"><i class="fas fa-truck fa-fw mr-3 text-gray-400"></i>Veículos</a>
                                {% endif %}
                            </div>
                        </div>

                        {% if current_user.role == 'gerente' %}
                        <div class="relative">
                            <button class="nav-dropdown-toggle flex items-center px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100">
                                <i class="fas fa-user-shield fa-fw mr-2"></i>
                                <span>Admin</span>
                                <i class="fas fa-chevron-down ml-2 text-xs"></i>
                            </button>
                            <div class="dropdown-menu absolute right-0 mt-2 w-56 bg-white rounded-md shadow-lg py-1">
                                <a href="#" class="nav-link flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" data-section="usuarios"><i class="fas fa-users-cog fa-fw mr-3 text-gray-400"></i>Utilizadores</a>
                                <a href="#" class="nav-link flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" data-section="codigos_acesso"><i class="fas fa-key fa-fw mr-3 text-gray-400"></i>Chaves de Acesso</a>
                            </div>
                        </div>
                        {% endif %}
                    </nav>

                    <div class="flex items-center space-x-4">
                        {% if current_user.is_authenticated %}
                            <div class="text-right hidden sm:block">
                                <p class="text-sm font-medium text-gray-900">{{ current_user.username }}</p>
                                <p class="text-xs text-gray-500 capitalize">{{ current_user.role }}</p>
                            </div>
                            <a href="{{ url_for('auth.logout') }}" class="text-gray-500 hover:text-red-600 p-2 rounded-full" title="Sair">
                                <i class="fas fa-sign-out-alt"></i>
                            </a>
                        {% endif %}
                        <button id="mobile-menu-button" class="md:hidden text-gray-500 p-2">
                            <i class="fas fa-bars"></i>
                        </button>
                    </div>
                </div>
            </div>

            <div id="mobile-menu" class="hidden md:hidden bg-white border-t">
                <a href="#" class="nav-link flex items-center px-4 py-3 text-base text-gray-700 hover:bg-gray-100" data-section="dashboard"><i class="fas fa-tachometer-alt fa-fw mr-3"></i>Dashboard</a>
                
                <h3 class="px-4 pt-3 pb-2 text-sm font-semibold text-gray-500">Gerenciamento</h3>
                <a href="#" class="nav-link flex items-center pl-8 pr-4 py-2 text-base text-gray-700 hover:bg-gray-100" data-section="movimentacoes"><i class="fas fa-exchange-alt fa-fw mr-3 text-gray-400"></i>Movimentações</a>
                <a href="#" class="nav-link flex items-center pl-8 pr-4 py-2 text-base text-gray-700 hover:bg-gray-100" data-section="controle_combustivel"><i class="fas fa-gas-pump fa-fw mr-3 text-gray-400"></i>Combustível</a>
                <a href="#" class="nav-link flex items-center pl-8 pr-4 py-2 text-base text-gray-700 hover:bg-gray-100" data-section="manutencoes"><i class="fas fa-tools fa-fw mr-3 text-gray-400"></i>Manutenções</a>
                
                
                <h3 class="px-4 pt-3 pb-2 text-sm font-semibold text-gray-500">Relatórios</h3>
                <a href="#" class="nav-link flex items-center pl-8 pr-4 py-2 text-base text-gray-700 hover:bg-gray-100" data-section="relatorios"><i class="fas fa-exchange-alt fa-fw mr-3 text-gray-400"></i>Movimentações</a>
                <a href="#" class="nav-link flex items-center pl-8 pr-4 py-2 text-base text-gray-700 hover:bg-gray-100" data-section="relatorios"><i class="fas fa-tools fa-fw mr-3 text-gray-400"></i>Custos de Manutenção</a>
                <a href="#" class="nav-link flex items-center pl-8 pr-4 py-2 text-base text-gray-700 hover:bg-gray-100" data-section="relatorios"><i class="fas fa-boxes-stacked fa-fw mr-3 text-gray-400"></i>Posição de Estoque</a>
                
                <h3 class="px-4 pt-3 pb-2 text-sm font-semibold text-gray-500">Cadastros</h3>
                <a href="#" class="nav-link flex items-center pl-8 pr-4 py-2 text-base text-gray-700 hover:bg-gray-100" data-section="categorias"><i class="fas fa-tags fa-fw mr-3 text-gray-400"></i>Categorias</a>
                <a href="#" class="nav-link flex items-center pl-8 pr-4 py-2 text-base text-gray-700 hover:bg-gray-100" data-section="almoxarifados"><i class="fas fa-warehouse fa-fw mr-3 text-gray-400"></i>Almoxarifados</a>
                <a href="#" class="nav-link flex items-center pl-8 pr-4 py-2 text-base text-gray-700 hover:bg-gray-100" data-section="setores"><i class="fas fa-building fa-fw mr-3 text-gray-400"></i>Setores</a>
                <a href="#" class="nav-link flex items-center pl-8 pr-4 py-2 text-base text-gray-700 hover:bg-gray-100" data-section="funcoes"><i class="fas fa-id-card fa-fw mr-3 text-gray-400"></i>Funções</a>
                <a href="#" class="nav-link flex items-center pl-8 pr-4 py-2 text-base text-gray-700 hover:bg-gray-100" data-section="tipos_combustivel"><i class="fas fa-gas-pump fa-fw mr-3 text-gray-400"></i>Tipos de Combustível</a>
                <a href="#" class="nav-link flex items-center pl-8 pr-4 py-2 text-base text-gray-700 hover:bg-gray-100" data-section="tipos_veiculo"><i class="fas fa-car-side fa-fw mr-3 text-gray-400"></i>Tipos de Veículo</a>
                <a href="#" class="nav-link flex items-center pl-8 pr-4 py-2 text-base text-gray-700 hover:bg-gray-100" data-section="funcionarios"><i class="fas fa-user-tie fa-fw mr-3 text-gray-400"></i>Funcionários</a>
                <a href="#" class="nav-link flex items-center pl-8 pr-4 py-2 text-base text-gray-700 hover:bg-gray-100" data-section="veiculos"><i class="fas fa-truck fa-fw mr-3 text-gray-400"></i>Veículos</a>
                <a href="#" class="nav-link flex items-center pl-8 pr-4 py-2 text-base text-gray-700 hover:bg-gray-100" data-section="produtos"><i class="fas fa-boxes-stacked fa-fw mr-3 text-gray-400"></i>Produtos</a>
                {% if current_user.role == 'gerente' %}
                <h3 class="px-4 pt-3 pb-2 text-sm font-semibold text-gray-500">Admin</h3>
                <a href="#" class="nav-link flex items-center pl-8 pr-4 py-2 text-base text-gray-700 hover:bg-gray-100" data-section="usuarios"><i class="fas fa-users-cog fa-fw mr-3 text-gray-400"></i>Utilizadores</a>
                <a href="#" class="nav-link flex items-center pl-8 pr-4 py-2 text-base text-gray-700 hover:bg-gray-100" data-section="codigos_acesso"><i class="fas fa-key fa-fw mr-3 text-gray-400"></i>Chaves de Acesso</a>
                {% endif %}
            </div>
        </header>

        <main class="p-4 md:p-6 flex-1 overflow-y-auto">
            {% block content %}{% endblock %}
        </main>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- SCRIPT PARA DROPDOWNS DO HEADER (DESKTOP) ---
        const dropdownToggles = document.querySelectorAll('.nav-dropdown-toggle');

        const closeAllDropdowns = () => {
            document.querySelectorAll('.dropdown-menu').forEach(menu => {
                menu.classList.remove('show');
            });
        };

        dropdownToggles.forEach(toggle => {
            toggle.addEventListener('click', (event) => {
                event.stopPropagation();
                const menu = toggle.nextElementSibling;
                const isVisible = menu.classList.contains('show');
                closeAllDropdowns();
                if (!isVisible) {
                    menu.classList.add('show');
                }
            });
        });

        window.addEventListener('click', () => {
            closeAllDropdowns();
        });

        // --- SCRIPT PARA MENU MOBILE ---
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');

        if (mobileMenuButton) {
            mobileMenuButton.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
            });
        }
        
        mobileMenu.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', () => {
                mobileMenu.classList.add('hidden');
            });
        });
    });
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script>
        // Código para registar o Service Worker (PWA)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register("{{ url_for('static', filename='service-worker.js') }}")
                    .then(registration => {
                        console.log('Service Worker registado com sucesso:', registration);
                    })
                    .catch(error => {
                        console.log('Registro do Service Worker falhou:', error);
                    });
            });
        }
    </script>
    {% block scripts %}{% endblock %}
</body>
</html>